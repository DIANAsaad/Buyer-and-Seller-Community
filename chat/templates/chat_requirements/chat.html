{% extends 'main/base.html' %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center text-primary fw-bold">Chat Room</h2>
    
    <!-- Chat box with a background -->
    <div id="chat-box" class="chat-box border rounded p-3 mb-3 position-relative" 
         style="background-image: url('/static/img/whatsapp-bg.png'), linear-gradient(to bottom right, #f0f8ff, #e6f7ff); background-size: cover; height: 400px; overflow-y: auto;">
        
        <!-- Loop through each message in group_messages -->
        {% for group_message in group_messages %}
            <div class="message d-flex mb-3 
                        {% if group_message.author == request.user %} justify-content-end user-message {% else %} justify-content-start other-message {% endif %}">
                
                {% if group_message.author != request.user %}
                    <!-- Avatar for other users' messages -->
                    <div class="avatar me-2">
                        {% for profile in group_message.author.profile_set.all %}
                        <img src="{{ profile.profile_image_url }}" class="rounded-circle" alt="Avatar">
                        {% endfor %}
                    </div>
                {% endif %}
                
                <!-- Message content with new styles -->
                <div class="message-content p-3 rounded shadow-sm">
                    <strong class="d-block">{{ group_message.author }}</strong>
                    <p class="mb-0">{{ group_message.body }}</p>
                    <small class="text-muted d-block text-end mt-1">{{ group_message.timestamp|date:"H:i" }}</small>
                </div>
                
                {% if group_message.author == request.user %}
                    <!-- Avatar for the current user's messages -->
                    <div class="avatar ms-2">
                        {% for profile in group_message.author.profile_set.all %}
                        <img src="{{ profile.profile_image_url }}" class="rounded-circle" alt="Avatar">
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
        
    </div>

    <!-- Form to send a new message -->
    <form id="message-form" method="post" class="mt-3">
        {% csrf_token %}
        <div class="input-group">
            <input type="text" name="message" id="message" class="form-control" placeholder="Type your message..." required>
            <button type="submit" class="btn btn-primary">Send</button>
        </div>
    </form>
</div>

<style>
    /* Chat box with gradient overlay background */
    .chat-box {
        background-size: cover;
        border: 1px solid rgba(173, 114, 55, 0.75);
        border-radius: 15px;
        padding: 15px;
        position: relative;
        color: #333;
    }

    .message-content {
        font-size: 15px;
        line-height: 1.6;
        max-width: 75%;
    }

    .message {
        display: flex;
        align-items: center;
    }

    .avatar img {
        width: 40px;
        height: 40px;
    }

    .message-content strong {
        font-weight: 600;
        color: #5d5d5d;
    }

    .user-message .message-content {
        background-color: #dcf8c6;
        border-radius: 10px 0px 10px 10px;
        text-align: right;
        border: 1px solid #b2d8a5;
    }

    .other-message .message-content {
        background-color: #ffffff;
        border-radius: 0px 10px 10px 10px;
        text-align: left;
        border: 1px solid #ddd;
    }

    /* Add shadow effect to the messages */
    .message-content {
        box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.1);
    }

    /* Time styling */
    .message-content small {
        font-size: 12px;
        color: #999;
    }
</style>
{% endblock %}
